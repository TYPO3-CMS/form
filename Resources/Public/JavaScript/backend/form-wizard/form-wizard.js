/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import"@typo3/backend/wizard/wizard.js";import{state as p,property as l,query as b,customElement as S}from"lit/decorators.js";import u from"@typo3/form/backend/form-wizard/steps/settings-step.js";import{LitElement as g,html as f}from"lit";import c from"~labels/form.form_manager_javascript";import{StepSummaryEvent as h}from"@typo3/backend/wizard/events/step-summary-event.js";import{DuplicateFormSubmissionService as v}from"@typo3/form/backend/form-wizard/finisher/duplicate-form-submission-service.js";import w from"@typo3/form/backend/form-wizard/steps/mode-step.js";import{CreateFormSubmissionService as y}from"@typo3/form/backend/form-wizard/finisher/create-form-submission-service.js";import{FormManager as z}from"@typo3/form/backend/form-manager.js";import{AutoAdvanceEvent as M}from"@typo3/backend/wizard/events/auto-advance-event.js";var o=function(a,e,t,s){var n=arguments.length,i=n<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(a,e,t,s);else for(var d=a.length-1;d>=0;d--)(m=a[d])&&(i=(n<3?m(i):n>3?m(e,t,i):m(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i};let r=class extends g{constructor(){super(...arguments),this.steps=[],this.errorMessage=null}connectedCallback(){super.connectedCallback(),this.addEventListener(h.eventName,this.handleStepSummary)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener(h.eventName,this.handleStepSummary)}firstUpdated(e){if(super.firstUpdated(e),this.formManager.getAccessibleFormStorageFolders().length<1){this.errorMessage=c.get("formManager.newFormWizard.step1.noStorages");return}const t={wizard:this.wizard,formManager:this.formManager,getStoreData:this.wizard.getStoreData.bind(this.wizard),setStoreData:this.wizard.setStoreData.bind(this.wizard),clearStoreData:this.wizard.clearStoreData.bind(this.wizard),getDataStore:this.wizard.getDataStore.bind(this.wizard),dispatchAutoAdvance:()=>this.wizard.dispatchEvent(new M)};this.duplicateForm!=null?(this.steps=[new u(t)],this.submissionService=new v(t,this.duplicateForm.persistenceIdentifier)):(this.steps=[new w(t),new u(t)],this.submissionService=new y(t))}createRenderRoot(){return this}render(){return this.errorMessage?this.wizard.renderError(this.errorMessage):f`<typo3-backend-wizard .steps=${this.steps} .submissionService=${this.submissionService} confirm-button-label=${c.get("formManager.newFormWizard.step1.title")}></typo3-backend-wizard>`}handleStepSummary(e){this.duplicateForm!==null&&(e.detail.summaryData=[{label:c.get("formManager.form_copied"),value:f`<typo3-backend-icon identifier=content-form size=small class=me-1></typo3-backend-icon>${this.duplicateForm.name}`},...e.detail.summaryData])}};o([p()],r.prototype,"steps",void 0),o([p()],r.prototype,"submissionService",void 0),o([p()],r.prototype,"errorMessage",void 0),o([l({type:z,attribute:!1})],r.prototype,"formManager",void 0),o([l({type:Object,attribute:!1})],r.prototype,"duplicateForm",void 0),o([b("typo3-backend-wizard")],r.prototype,"wizard",void 0),r=o([S("typo3-backend-form-wizard")],r);export{r as FormWizard};
