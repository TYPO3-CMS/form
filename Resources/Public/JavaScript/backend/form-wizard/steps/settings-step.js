/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{html as o,nothing as m}from"lit";import{MODE as n}from"@typo3/form/backend/form-wizard/steps/mode-step.js";import a from"~labels/form.form_manager_javascript";class i{constructor(e){this.context=e,this.key="settings",this.title=a.get("formManager.newFormWizard.step2.title"),this.autoAdvance=!0,this.data={formName:"",savePath:"",prototype:"",template:""},this.reset()}isComplete(){return this.getValue()?.formName!==""}render(){return o`${this.renderPredefinedFormFields()} ${this.renderSavePath()} ${this.renderFormNameInput()}`}reset(){this.setValue({formName:"",savePath:this.context.formManager.getAccessibleFormStorageFolders()[0]?.value??""}),this.setPrototype(this.context.formManager.getPrototypes()[0]?.value??""),this.context.clearStoreData(this.key)}getValue(){return this.data}setValue(e){this.data={...this.data,...e},this.context.wizard.requestUpdate()}beforeAdvance(){this.context.setStoreData(this.key,this.getValue())}getSummaryData(){const e=this.context.getStoreData(this.key),r=this.context.formManager.getPrototypes().find(t=>t.value=e.prototype)?.label,s=this.context.formManager.getTemplatesForPrototype(e.prototype).find(t=>t.value===e.template)?.label;return[...this.context.getStoreData("mode")===n.Predefined?[{value:r,label:a.get("formManager.form_prototype")},{value:s,label:a.get("formManager.form_template")}]:[],{value:e.formName,label:a.get("formManager.form_name")},{value:e.savePath,label:a.get("formManager.form_save_path")}]}renderSavePath(){const e=this.context.formManager.getAccessibleFormStorageFolders()??[];return e.length<=1?m:o`<div class=form-group><label class=form-label for=new-form-save-path>${a.get("formManager.form_save_path")}</label><div class=form-description for=new-form-save-path>${a.get("formManager.form_save_path_description")}</div><select class="new-form-save-path form-select" id=new-form-save-path data-identifier=newFormSavePath>${e.map(r=>o`<option value=${r.label} ?selected=${r.value===this.data.savePath} @change=${s=>this.setValue({savePath:s.target.value})}>${r.label}</option>`)}</select></div>`}renderFormNameInput(){return o`<div class=form-group><label class=form-label for=new-form-name>${a.get("formManager.form_name")}</label><div class=form-description>${a.get("formManager.form_name_description")}</div><input class="form-control ${this.isComplete()?"":"has-error"}" id=new-form-name data-identifier=newFormName name=newFormName .value=${this.data.formName} @change=${e=>this.setValue({formName:e.target.value})}></div>`}renderPredefinedFormFields(){const e=this.context.formManager.getPrototypes()??[];if(this.context.getStoreData("mode")!==n.Predefined||e.length<1)return m;const r=this.data.prototype,s=this.context.formManager.getTemplatesForPrototype(r);let l=m;return s.length>0&&(l=o`<div class=form-group><label class=form-label for=new-form-template>${a.get("formManager.form_template")}</label> <select class="new-form-template form-select" id=new-form-template data-identifier=newFormTemplate @change=${t=>this.setValue({template:t.target.value})}>${s.map(t=>o`<option ?selected=${t.value===this.data.template} value=${t.value}>${t.label}</option>`)}</select></div>`),o`<div class=form-group><label class=form-label for=new-form-prototype-name>${a.get("formManager.form_prototype")}</label> <select class="new-form-prototype-name form-select" id=new-form-prototype-name data-identifier=newFormPrototype @change=${t=>this.setPrototype(t.currentTarget.value)}>${e.map(t=>o`<option value=${t.value} ?selected=${t.value===this.data.prototype}>${t.label}</option>`)}</select></div>${l}`}setPrototype(e){const r=this.context.formManager.getTemplatesForPrototype(e);this.setValue({prototype:e,template:r[0]?.value??""})}}export{i as SettingsStep,i as default};
