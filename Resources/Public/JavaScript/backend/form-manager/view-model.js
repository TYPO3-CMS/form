/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import n from"jquery";import l from"@typo3/backend/modal.js";import g from"@typo3/backend/severity.js";import p from"@typo3/backend/icons.js";import h from"@typo3/backend/notification.js";import k from"@typo3/core/security-utility.js";import{SeverityEnum as v}from"@typo3/backend/enum/severity.js";import{topLevelModuleImport as b}from"@typo3/backend/utility/top-level-module-import.js";import{html as M}from"lit";import t from"~labels/form.form_manager_javascript";const m=new k;var d;(function(e){e.newFormModalTrigger='[data-identifier="newForm"]',e.duplicateFormModalTrigger='[data-identifier="duplicateForm"]',e.removeFormModalTrigger='[data-identifier="removeForm"]',e.showReferences='[data-identifier="showReferences"]',e.referenceLink='[data-identifier="referenceLink"]'})(d||(d={}));function F(e){n(d.newFormModalTrigger).on("click",async function(){await b("@typo3/form/backend/form-wizard/form-wizard.js");const a=M`<typo3-backend-form-wizard .formManager=${e}></typo3-backend-form-wizard>`;l.advanced({title:t.get("formManager.newFormWizard.step1.title"),content:a,severity:v.notice,size:l.sizes.medium,staticBackdrop:!0,buttons:[]})})}function z(e){n(d.removeFormModalTrigger).on("click",function(a){const c=[];a.preventDefault();const f=n(a.currentTarget);c.push({text:t.get("formManager.cancel"),active:!0,btnClass:"btn-default",name:"cancel",trigger:function(r,o){o.hideModal()}}),c.push({text:t.get("formManager.remove_form"),active:!0,btnClass:"btn-danger",name:"createform",trigger:function(r,o){n.post(e.getAjaxEndpoint("delete"),{formPersistenceIdentifier:f.data("formPersistenceIdentifier")},function(s){s.status==="success"?document.location=s.url:h.error(s.title,s.message),o.hideModal()})}}),l.show(t.get("formManager.remove_form_title"),t.get("formManager.remove_form_message",{0:f.data("formName")}),g.error,c)})}function T(e){n(d.duplicateFormModalTrigger).on("click",async function(a){a.preventDefault();const c=n(a.currentTarget);await b("@typo3/form/backend/form-wizard/form-wizard.js");const f={name:c.data("formName"),persistenceIdentifier:c.data("formPersistenceIdentifier")},r=M`<typo3-backend-form-wizard .formManager=${e} .duplicateForm=${f}></typo3-backend-form-wizard>`;l.advanced({title:t.get("formManager.duplicateFormWizard.step1.title",{0:c.data("formName")}),content:r,severity:v.notice,size:l.sizes.medium,staticBackdrop:!0,buttons:[]})})}function I(e){n(d.showReferences).on("click",a=>{a.preventDefault();const c=n(a.currentTarget),f=e.getAjaxEndpoint("references")+"&formPersistenceIdentifier="+c.data("formPersistenceIdentifier");n.get(f,async function(r){let o;const s=[];s.push({text:t.get("formManager.cancel"),active:!0,btnClass:"btn-default",name:"cancel",trigger:function(i,u){u.hideModal()}});const w=r.references.length,y=await p.getIcon("actions-open",p.sizes.small);if(w>0){o='<h2 class="h3">'+t.get("formManager.references.headline")+'</h2><div class="table-fit"><table id="forms" class="table table-striped table-hover"><thead><tr><th class="col-icon"></th><th class="col-recordtitle">'+t.get("formManager.table.field.title")+"</th><th>"+t.get("formManager.table.field.uid")+'</th><th class="col-control nowrap"><span class="visually-hidden">'+t.get("formManager.table.field.control")+"</span></th></tr></thead><tbody>";for(let i=0,u=r.references.length;i<u;++i)o+='<tr><td class="col-icon">'+r.references[i].recordIcon+'</td><td class="col-recordtitle"><a href="'+m.encodeHtml(r.references[i].recordEditUrl)+'" data-identifier="referenceLink">'+m.encodeHtml(r.references[i].recordTitle)+"</a></td><td>"+m.encodeHtml(r.references[i].recordUid)+'</td><td class="col-control"><div class="btn-group" role="group"><a href="'+m.encodeHtml(r.references[i].recordEditUrl)+'" data-identifier="referenceLink" class="btn btn-default" title="'+t.get("formManager.btn.edit.title")+'">'+y+"</a></div></td></tr>";o+="</tbody></table></div>"}else o="<div><h1>"+t.get("formManager.references.title",{0:m.encodeHtml(r.formPersistenceIdentifier)})+"</h1></div><div>"+t.get("formManager.no_references")+"</div>";o=n(o),n(d.referenceLink,o).on("click",function(i){i.preventDefault(),l.currentModal.hideModal(),document.location=n(i.currentTarget).prop("href")}),l.show(t.get("formManager.references.title",{0:c.data("formName")}),o,g.notice,s)}).fail(function(r,o,s){r.status!==0&&h.error(o,s,2)})})}function L(e){z(e),F(e),T(e),I(e)}export{L as bootstrap};
